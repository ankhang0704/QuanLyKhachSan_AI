{% extends 'base.html' %}
{% load static %}

{% block title %}
Dịch vụ - {{ service.name }}
{% endblock title %}

{% block content %}



<div class="bg-base-200 py-12">
    <div class="container mx-auto px-4 max-w-7xl">
        <p class="text-primary font-semibold mb-1">{{ service.get_category_display }}</p>
        <h1 class="text-4xl md:text-5xl font-bold text-base-content">{{ service.name }}</h1>
    </div>
</div>

<div class="container mx-auto px-4 py-16 max-w-7xl">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 lg:gap-12">

        <div class="lg:col-span-2">

            <div id="image-gallery-container"
                class="relative w-full rounded-2xl shadow-xl aspect-video overflow-hidden group mb-8">

                {% for img in service.gallery.all %}
                <div
                    class="gallery-slide absolute inset-0 transition-opacity duration-300 ease-in-out {% if not forloop.first %}opacity-0 pointer-events-none{% else %}opacity-100{% endif %}">

                    <img src="{{ img.image.url }}" class="w-full h-full object-cover cursor-pointer"
                        alt="{{ img.caption|default:service.name }}" onclick="openImageModal('{{ img.image.url }}')">
                </div>
                {% empty %}
                <div class="relative w-full h-full">
                    <img src="{% static 'images/placeholder.png' %}" class="w-full h-full object-cover"
                        alt="Chưa có ảnh" />
                </div>
                {% endfor %}

                {% if service.gallery.all|length > 1 %}
                <div class="absolute flex justify-between transform -translate-y-1/2 left-5 right-5 top-1/2 z-10">
                    <button id="gallery-prev" class="btn btn-circle btn-glass">❮</button>
                    <button id="gallery-next" class="btn btn-circle btn-glass">❯</button>
                </div>
                {% endif %}
            </div>

            <div class="divider"></div>

            <h3 class="text-3xl font-bold text-base-content mt-8 mb-4">Mô tả chi tiết</h3>
            <article class="prose max-w-none text-base-content/90 text-lg">
                {{ service.description | linebreaks }}
            </article>

        </div>

        <div class="lg:col-span-1">
            <div class="card bg-base-100 shadow-xl border border-base-300 sticky top-24">
                <div class="card-body p-6">
                    <h3 class="card-title text-2xl mb-5">Thông tin Dịch vụ</h3>

                    <div class="space-y-4">
                        <div class="flex items-start gap-3">
                            <i class="fas fa-clock text-primary text-xl mt-1 w-6 text-center"></i>
                            <div>
                                <h4 class="font-semibold text-base-content">Giờ hoạt động</h4>
                                <p class="text-base-content/80">{{ service.opening_hours  }}</p>
                            </div>
                        </div>

                        <div class="divider my-1"></div>

                        <div class="flex items-start gap-3">
                            <i class="fas fa-tags text-primary text-xl mt-1 w-6 text-center"></i>
                            <div>
                                <h4 class="font-semibold text-base-content">Chi phí</h4>
                                <p class="text-lg font-bold text-accent">
                                    {{ service.price_info }}
                                </p>
                            </div>
                        </div>

                        {% if service.rules %}
                        <div class="divider my-1"></div>
                        <div class="flex items-start gap-3">
                            <i class="fas fa-gavel text-primary text-xl mt-1 w-6 text-center"></i>
                            <div>
                                <h4 class="font-semibold text-base-content">Quy định</h4>
                                <div class="prose prose-sm text-base-content/80">
                                    {{ service.rules | linebreaksbr }}
                                </div>
                            </div>
                        </div>
                        {% endif %}
                    </div>

                    <div class="card-actions justify-center mt-6 pt-4 border-t border-base-300">
                        <a href="{% url 'service_list' %}" class="btn btn-primary btn-outline w-full">
                            <i class="fas fa-arrow-left mr-2"></i>
                            Quay lại Danh sách
                        </a>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<dialog id="image_zoom_modal" class="modal">
    <div class="modal-box w-11/12 max-w-5xl p-0 bg-transparent shadow-none">
        <img id="modal_zoom_image" src="" alt="Ảnh phóng to" class="w-full h-auto object-contain" />
        <div class="modal-action absolute top-0 right-0 m-2">
            <form method="dialog">
                <button class="btn btn-sm btn-circle btn-ghost text-white bg-black/30 hover:bg-black/60">✕</button>
            </form>
        </div>
    </div>
    <form method="dialog" class="modal-backdrop bg-black/70 backdrop-blur-sm">
        <button>đóng</button>
    </form>
</dialog>
{% endblock %}


{% block extra_js %}
{{ block.super }}
<script>
    // --- HÀM MỞ MODAL ZOOM ---
    function openImageModal(imageUrl) {
        const modal = document.getElementById('image_zoom_modal');
        const modalImage = document.getElementById('modal_zoom_image');
        if (modal && modalImage) {
            modalImage.src = imageUrl;
            modal.showModal();
        }
    }

    // --- LOGIC CHO FADE CAROUSEL ---
    document.addEventListener("DOMContentLoaded", function () {
        const galleryContainer = document.getElementById('image-gallery-container');

        if (galleryContainer) {
            const slides = galleryContainer.querySelectorAll('.gallery-slide');
            const prevBtn = document.getElementById('gallery-prev');
            const nextBtn = document.getElementById('gallery-next');
            let currentSlideIndex = 0;

            if (slides.length > 1) {

                function showSlide(index) {
                    slides.forEach((slide, i) => {
                        if (i === index) {
                            slide.classList.remove('opacity-0', 'pointer-events-none');
                            slide.classList.add('opacity-100');
                        } else {
                            slide.classList.remove('opacity-100');
                            slide.classList.add('opacity-0', 'pointer-events-none');
                        }
                    });
                }

                prevBtn.addEventListener('click', () => {
                    currentSlideIndex = (currentSlideIndex - 1 + slides.length) % slides.length;
                    showSlide(currentSlideIndex);
                });

                nextBtn.addEventListener('click', () => {
                    currentSlideIndex = (currentSlideIndex + 1) % slides.length;
                    showSlide(currentSlideIndex);
                });

                showSlide(currentSlideIndex);

            } else {
                // Nếu chỉ có 1 ảnh, ẩn các nút điều hướng
                if (prevBtn) prevBtn.style.display = 'none';
                if (nextBtn) nextBtn.style.display = 'none';
            }
        }
    });
</script>
{% endblock %}