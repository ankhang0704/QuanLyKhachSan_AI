{% extends 'base.html' %}
{% load i18n %}

{% block head_title %}
Hồ sơ của tôi
{% endblock head_title %}

{% block content %}
<!-- Sử dụng bg-base-200 để đồng bộ với các trang khác và thêm padding -->
<div class="min-h-screen bg-base-200 p-4 md:p-8">
    <div class="container mx-auto max-w-6xl">

        <!-- Tiêu đề chào mừng -->
        <h1 class="text-3xl lg:text-4xl font-bold mb-8 text-base-content">
            Chào mừng, {{ user.first_name|default:user.username }}!
        </h1>

        <!-- Layout Grid chính (2/3 + 1/3 trên desktop) -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">

            <!-- CỘT NỘI DUNG CHÍNH (2/3) -->
            <div class="lg:col-span-2 space-y-6">

                <!-- Thông báo chuyến đi sắp tới (nếu có) -->
                {% if upcoming_booking %}
                <div class="card w-full bg-info text-info-content shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Chuyến đi sắp tới của bạn!
                        </h2>
                        <p>Bạn có một đơn đặt phòng ({{ upcoming_booking.room.room_type.name }}) đang chờ.</p>
                        <p><strong>Ngày nhận phòng:</strong> {{ upcoming_booking.check_in|date:"d/m/Y" }}</p>
                        <div class="card-actions justify-end mt-2">
                            <a href="{% url 'my_booking_detail' upcoming_booking.id %}"
                                class="btn btn-info-content btn-outline">
                                Xem chi tiết
                            </a>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Card Thông tin tài khoản -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title mb-4">Thông tin tài khoản</h2>

                        <div class="flex flex-col sm:flex-row items-center sm:items-start gap-6">
                            <!-- Avatar -->
                            <div class="avatar">
                                <div class="w-24 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2">
                                    {% if user.socialaccount_set.all.0.get_avatar_url %}
                                    <img src="{{ user.socialaccount_set.all.0.get_avatar_url }}" alt="Avatar Google">
                                    {% elif user.profile_picture %}
                                    <img src="{{ user.profile_picture.url }}" alt="Avatar cá nhân">
                                    {% else %}
                                    <!-- Cải tiến avatar mặc định -->
                                    <div
                                        class="flex items-center justify-center w-full h-full bg-primary text-primary-content text-3xl font-bold">
                                        {{ user.username.0|upper }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Chi tiết thông tin (căn chỉnh đẹp hơn) -->
                            <div class="flex-grow space-y-3 w-full">
                                <p>
                                    <strong
                                        class="font-semibold text-base-content/70 w-28 inline-block">Username:</strong>
                                    <span>{{ user.username }}</span>
                                </p>
                                <p>
                                    <strong class="font-semibold text-base-content/70 w-28 inline-block">Email:</strong>
                                    <span>{{ user.email }}</span>
                                </p>
                                <p>
                                    <strong class="font-semibold text-base-content/70 w-28 inline-block">Họ và
                                        tên:</strong>
                                    <span>{{ user.get_full_name|default:"(chưa có)" }}</span>
                                </p>
                                <p>
                                    <strong class="font-semibold text-base-content/70 w-28 inline-block">Số điện
                                        thoại:</strong>
                                    <span>{{ user.phone_number|default:"(chưa có)" }}</span>
                                </p>
                            </div>
                        </div>

                        <div class="card-actions justify-end mt-4">
                            <!-- Đã chuyển từ 'profile_edit' sang view của allauth (nếu có) hoặc 1 view chung -->
                            <!-- Giả sử bạn có 1 view 'profile_edit' -->
                            <a href="{% url 'profile_edit' %}" class="btn btn-sm btn-primary">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.536L16.732 3.732z" />
                                </svg>
                                Chỉnh sửa thông tin
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CỘT SIDEBAR (1/3) -->
            <div class="lg:col-span-1 space-y-6">

                <!-- Card Quản lý & Bảo mật -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title">Quản lý & Bảo mật</h2>
                        <div class="space-y-3 mt-4">
                            {% if not has_social_account %}
                            <a href="{% url 'account_change_password' %}" class="btn btn-outline btn-block">
                                Đổi mật khẩu
                            </a>
                            {% else %}
                            <div class="tooltip tooltip-bottom w-full"
                                data-tip="Bạn đăng nhập bằng Google, mật khẩu được quản lý bởi Google.">
                                <button class="btn btn-outline btn-block btn-disabled">
                                    Đổi mật khẩu
                                </button>
                            </div>
                            {% endif %}

                            <!-- Thêm nút Đăng xuất -->
                            <a href="{% url 'account_logout' %}" class="btn btn-outline btn-error btn-block">
                                Đăng xuất
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Card Lịch sử Đặt phòng -->
                <div class="card bg-base-100 shadow-xl">
                    <div class="card-body">
                        <h2 class="card-title">Lịch sử Đặt phòng</h2>
                        <p class="text-base-content/80 text-sm mt-2 mb-4">
                            Xem lại tất cả các chuyến đi trước đây và sắp tới của bạn.
                        </p>
                        <div class="card-actions justify-center">
                            <a href="{% url 'my_bookings' %}" class="btn btn-primary btn-block">
                                Xem Lịch sử
                            </a>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>
</div>
{% endblock content %}