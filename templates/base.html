{% load static %}
{% load socialaccount %}

<!DOCTYPE html>
<html lang="vi" data-theme="light">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="The Sailing Bay - Resort bên bờ biển tuyệt đẹp với trải nghiệm sang trọng và dịch vụ đẳng cấp." />
    <title>{% block title %}The Sailing Bay{% endblock %} | The Sailing Bay</title>

    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.19/dist/full.min.css" rel="stylesheet" type="text/css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="{% static 'css/styles.css' %}" rel="stylesheet" type="text/css">

    <!-- Tải Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">


    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: oklch(var(--b1));
        }

        html {
            scroll-behavior: smooth;
        }

        /* Nút nổi */
        .floating-btn {
            position: fixed;
            z-index: 40;
        }

        .floating-btn-chat {
            bottom: 2rem;
            right: 2rem;
            z-index: 1002;
        }

        .floating-btn-top {
            bottom: 6.5rem;
            right: 2rem;
        }

        @media (max-width: 640px) {
            .floating-btn-top {
                bottom: 6rem;
            }
        }

        /* Hiệu ứng */
        .gradient-text {
            background: linear-gradient(90deg, oklch(var(--p)) 0%, oklch(var(--a)) 50%, oklch(var(--p)) 100%);
            background-size: 200% auto;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            animation: gradient 4s linear infinite;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        @keyframes gradient {
            0% {
                background-position: 0% center;
            }

            100% {
                background-position: 200% center;
            }
        }

        .gradient-bg {
            background: linear-gradient(135deg, oklch(var(--p)) 0%, oklch(var(--pf)) 100%);
        }

        /* Navbar Glass */
        .glass {
            background: oklch(var(--b1) / 0.85);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid oklch(var(--b3));
        }

        /* CSS cho thanh cuộn (Tương thích Light/Dark mode) */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: oklch(var(--b2));
        }

        ::-webkit-scrollbar-thumb {
            background: oklch(var(--p));
            border-radius: 5px;
            border: 2px solid oklch(var(--b2));
        }

        ::-webkit-scrollbar-thumb:hover {
            background: oklch(var(--pf));
        }

        /* CSS cho Chatbot Loading (Giữ lại) */
        .loading-dots {
            display: inline-flex;
            gap: 6px;
        }

        .loading-dots span {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: oklch(var(--b1));
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .loading-dots span:nth-child(1) {
            animation-delay: -0.32s;
        }

        .loading-dots span:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes bounce {

            0%,
            80%,
            100% {
                transform: scale(0);
                opacity: 0.5;
            }

            40% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Khu vực tin nhắn - sử dụng CSS variables của daisyUI */
        #chat-messages {
            /* Màu nền sẽ được đặt bằng class bg-base-200 */
            scrollbar-width: thin;
            scrollbar-color: hsl(var(--p)) hsl(var(--b2));
            /* Màu chính (primary) và màu nền (base-200) */
        }

        /* Webkit (Chrome, Safari) scrollbar */
        #chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        #chat-messages::-webkit-scrollbar-track {
            background: hsl(var(--b2));
            /* Màu nền base-200 */
            border-radius: 10px;
        }

        #chat-messages::-webkit-scrollbar-thumb {
            background-color: hsl(var(--p));
            /* Màu chính (primary) */
            border-radius: 10px;
            border: 2px solid hsl(var(--b2));
        }

        /* Tùy chỉnh bong bóng chat của Bot (User sẽ dùng chat-bubble-primary) */
        .chat-start .chat-bubble {
            background-color: hsl(var(--b3));
            /* Màu base-300 (xám nhạt/tối) */
            color: hsl(var(--bc));
            /* Màu chữ base-content */
            /* GỠ BỎ white-space: pre-wrap; */
            overflow-wrap: break-word;
        }

        .chat-end .chat-bubble {
            /* GỠ BỎ white-space: pre-wrap; */
            overflow-wrap: break-word;
        }

        /* Nút mở Chat (ví dụ) - sử dụng màu primary */
        #open-chat-bubble {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 1000;
            background-color: hsl(var(--p));
            color: hsl(var(--pc));
            /* Màu chữ của Primary */
            width: 4rem;
            height: 4rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            cursor: pointer;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        #open-chat-bubble:hover {
            background-color: hsl(var(--pf));
            /* Màu Primary focus/hover */
            transform: scale(1.05);
        }
    </style>

    {% block extra_css %}{% endblock %}
</head>

<body class="min-h-screen flex flex-col bg-base-100">

    <header class="sticky top-0 z-50 glass">
        <div class="navbar max-w-7xl mx-auto px-4 lg:px-8">

            <div class="navbar-start">
                <div class="dropdown lg:hidden">
                    <label tabindex="0" class="btn btn-ghost btn-circle">
                        <i class="fas fa-bars text-xl"></i>
                    </label>
                    <!-- Menu di động (dropdown) -->
                    <ul tabindex="0"
                        class="menu menu-sm dropdown-content mt-3 z-[51] p-2 shadow bg-base-100 rounded-box w-52">
                        <li><a href="{% url 'home' %}"><i class="fas fa-home w-4"></i> Trang chủ</a></li>
                        <li><a href="{% url 'room_list' %}"><i class="fas fa-bed w-4"></i> Phòng nghỉ</a></li>
                        <li><a href="{% url 'service_list' %}"><i class="fas fa-concierge-bell w-4"></i> Dịch vụ</a>
                        </li>
                        <li>
                            <a href="{% url 'offers' %}" class="text-primary font-bold">
                                <i class="fas fa-gift w-4"></i> Ưu đãi
                            </a>
                        </li>
                        <li>
                            <!-- 
                          Sửa lỗi: Thẻ <summary> không nên lồng trong <li> 
                          Cách đúng của DaisyUI là <li><details><summary>...</summary><ul>...</ul></details></li>
                          Nhưng để đơn giản cho menu di động, chúng ta dùng <summary> làm tiêu đề.
                        -->
                            <summary class="py-2"><i class="fas fa-compass w-4"></i> Khám phá</summary>
                            <ul class="p-2">
                                <li><a href="{% url 'blog_list' %}"><i class="fas fa-newspaper w-5"></i> Tin tức &
                                        Blog</a></li>
                                <li><a href="{% url 'gallery' %}"><i class="fas fa-images w-5"></i> Thư viện ảnh</a>
                                </li>
                                <li><a href="{% url 'about' %}"><i class="fas fa-info-circle w-5"></i> Về chúng tôi</a>
                                </li>
                                <li><a href="{% url 'contact' %}"><i class="fas fa-envelope w-5"></i> Liên hệ</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>

                <a class="btn btn-ghost text-2xl font-bold no-animation" href="{% url 'home' %}">
                    <span class="gradient-text">Sailing Bay</span>
                </a>
            </div>

            <div class="navbar-center hidden lg:flex">
                <!-- Menu desktop (horizontal) -->
                <ul class="menu menu-horizontal px-1 text-base font-medium">
                    <li><a href="{% url 'home' %}" class="rounded-lg"><i class="fas fa-home"></i> Trang chủ</a></li>
                    <li><a href="{% url 'room_list' %}" class="rounded-lg"><i class="fas fa-bed"></i> Phòng nghỉ</a>
                    </li>
                    <li><a href="{% url 'service_list' %}" class="rounded-lg"><i class="fas fa-concierge-bell"></i> Dịch
                            vụ</a></li>
                    <li>
                        <a href="{% url 'offers' %}" class="text-primary font-bold rounded-lg">
                            <i class="fas fa-gift"></i> Ưu đãi
                        </a>
                    </li>
                    <li>
                        <details>
                            <summary class="rounded-lg"><i class="fas fa-compass"></i> Khám phá</summary>
                            <ul class="p-2 bg-base-100 rounded-t-none w-52 shadow-lg z-50">
                                <li><a href="{% url 'blog_list' %}"><i class="fas fa-newspaper w-5"></i> Tin tức &
                                        Blog</a></li>
                                <li><a href="{% url 'gallery' %}"><i class="fas fa-images w-5"></i> Thư viện ảnh</a>
                                </li>
                                <li><a href="{% url 'about' %}"><i class="fas fa-info-circle w-5"></i> Về chúng tôi</a>
                                </li>
                                <li><a href="{% url 'contact' %}"><i class="fas fa-envelope w-5"></i> Liên hệ</a></li>
                            </ul>
                        </details>
                    </li>
                </ul>
            </div>


            <div class="navbar-end gap-2">
                <!-- Nút chuyển theme -->
                <label class="swap swap-rotate btn btn-ghost btn-circle">
                    <input type="checkbox" id="theme-toggle" />
                    <i class="swap-off fas fa-moon text-lg"></i>
                    <i class="swap-on fas fa-sun text-lg"></i>
                </label>

                <!-- Logic User (Đã đăng nhập) -->
                {% if user.is_authenticated %}
                <div class="dropdown dropdown-end">
                    <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar no-animation">
                        <div class="w-10 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2">
                            {% get_social_accounts user as social_accounts %}
                            {% if user.socialaccount_set.all.0.get_avatar_url %}
                            <img src="{{ user.socialaccount_set.all.0.get_avatar_url }}" alt="User Avatar" />
                            {% elif user.profile_picture %}
                            <img src="{{ user.profile_picture.url }}" alt="User Avatar" />
                            {% else %}
                            <div
                                class="gradient-bg w-full h-full flex items-center justify-center text-white font-bold text-lg">
                                {{ user.first_name|first|default:user.username|first|upper }}
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <ul tabindex="0"
                        class="menu menu-sm dropdown-content mt-3 z-[51] p-3 shadow-lg bg-base-100 rounded-box w-64 border border-base-300">
                        <li class="menu-title px-4 py-3 border-b border-base-300">
                            <div class="flex flex-col">
                                <span class="text-base font-semibold text-base-content">
                                    {{ user.first_name|default:user.username }}
                                </span>
                                <span class="text-xs font-normal text-base-content/70">
                                    {{ user.email }}
                                </span>
                            </div>
                        </li>

                        <li class="mt-2">
                            <a href="{% url 'profile' %}" class="flex items-center gap-3">
                                <i class="fas fa-user-cog text-primary w-4 text-center"></i>
                                <span>Hồ sơ & Tài khoản</span>
                            </a>
                        </li>
                        <li class="mt-2">
                            <a href="{% url 'my_bookings' %}" class="flex items-center gap-3">
                                <i class="fas fa-history text-primary w-4 text-center"></i>
                                <span>Lịch sử đặt phòng</span>
                            </a>
                        </li>
                        <li class="mt-1">
                            <form action="{% url 'account_logout' %}" method="post" class="w-full">
                                {% csrf_token %}
                                <button type="submit"
                                    class="w-full text-left p-2 rounded-lg flex items-center gap-3 text-error hover:bg-error/10">
                                    <i class="fas fa-sign-out-alt w-4 text-center"></i>
                                    <span>Đăng xuất</span>
                                </button>
                            </form>
                        </li>
                    </ul>
                </div>
                <!-- Logic User (Chưa đăng nhập) -->
                {% else %}
                <div class="flex gap-2">
                    <a href="{% url 'account_login' %}" class="btn btn-ghost font-medium">
                        <i class="fas fa-sign-in-alt"></i> Đăng nhập
                    </a>
                    <a href="{% url 'account_signup' %}" class="btn btn-primary hidden sm:flex">
                        <i class="fas fa-user-plus"></i> Đăng ký
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </header>

    <main class="flex-grow">
        {% block content %}
        {% endblock %}
    </main>



    <button id="open-chat-bubble"
        class="btn btn-circle btn-lg floating-btn floating-btn-chat text-white border-0 shadow-lg hover:shadow-xl hover:scale-110 transition-all bg-gradient-to-br from-primary to-primary-focus"
        aria-label="Mở cửa sổ chat">
        <i class="fas fa-comment-dots text-2xl"></i>
    </button>

    <!-- Cửa sổ Chat Popup -->
    <div id="chat-popup"
        class="hidden fixed bottom-24 right-4 sm:right-8 w-[90vw] max-w-md h-[70vh] max-h-[600px] z-[1001] bg-base-100 rounded-2xl shadow-xl border border-base-300 flex flex-col transition-all duration-300 transform origin-bottom-right scale-95 opacity-0">
    
        <!-- Header - sử dụng màu base-100 và border -->
        <div class="flex items-center justify-between p-3 bg-base-100 border-b border-base-300 rounded-t-2xl shadow-sm">
            <h3 class="text-lg font-bold flex items-center gap-3 ml-2">
                <i class="fas fa-robot"></i>
                <span>Tư vấn viên AI</span>
            </h3>
    
            <div class="flex items-center">
                <button id="close-chat-btn" class="btn btn-ghost btn-sm btn-circle" aria-label="Đóng cửa sổ chat">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
        </div>
    
        <!-- Khu vực tin nhắn - dùng bg-base-200 -->
        <div id="chat-messages" class="flex-1 flex flex-col gap-2 overflow-y-auto p-4 bg-base-200">
            <!-- Tin nhắn mẫu của Bot -->
            <div class="chat chat-start">
                <div class="chat-image avatar">
                    <!-- CẬP NHẬT: Dùng <img> thay vì icon -->
                    <div class="w-10 rounded-full">
                        <img alt="Bot Avatar" src="https://placehold.co/40x40/A9ADC1/3D4451?text=Bot&font=inter" />
                    </div>
                </div>
                <div class="chat-bubble">
                    Xin chào! Tôi là trợ lý AI của The Sailing Bay, tôi có thể giúp gì cho bạn?
                </div>
            </div>  
            <!-- JavaScript sẽ điền tin nhắn vào đây -->
        </div>
    
        <!-- Form nhập liệu - dùng bg-base-100 và bo tròn -->
        <form id="chat-form" class="flex items-center gap-2 p-3 border-t border-base-300 bg-base-100 rounded-b-2xl">
            <input id="chat-input" type="text" placeholder="Nhập câu hỏi..."
                class="input input-bordered w-full rounded-full focus:border-primary focus:ring-1 focus:ring-primary" />
            <button id="chat-submit-btn" type="submit" class="btn btn-primary btn-circle flex-shrink-0"
                aria-label="Gửi tin nhắn">
                <i class="fas fa-paper-plane text-lg"></i>
            </button>
        </form>
    </div>
    <button id="backToTop"
        class="floating-btn floating-btn-top btn btn-circle text-white shadow-lg opacity-0 pointer-events-none transition-all duration-300 hover:scale-110 bg-gradient-to-br from-primary to-primary-focus"
        title="Back to top">
        <i class="fas fa-arrow-up"></i>
    </button>

    <footer class="bg-neutral text-neutral-content mt-auto">
        <div class="footer max-w-7xl mx-auto p-10">
            <aside>
                <a class="btn btn-ghost text-2xl font-bold no-animation" href="{% url 'home' %}">
                    <span class="gradient-text">Sailing Bay</span>
                </a>
                <p>Trang web giới thiệu về dự án "The Sailing Bay"<br>Cung cấp dịch vụ đặt phòng khách sạn ven biển.
                </p>
                <div class="flex gap-3 mt-4">
                    <a href="#" class="btn btn-circle btn-sm btn-ghost" aria-label="Facebook"><i
                            class="fab fa-facebook-f text-lg"></i></a>
                    <a href="#" class="btn btn-circle btn-sm btn-ghost" aria-label="Twitter"><i
                            class="fab fa-twitter text-lg"></i></a>
                    <a href="#" class="btn btn-circle btn-sm btn-ghost" aria-label="LinkedIn"><i
                            class="fab fa-linkedin-in text-lg"></i></a>
                    <a href="#" class="btn btn-circle btn-sm btn-ghost" aria-label="GitHub"><i
                            class="fab fa-github text-lg"></i></a>
                </div>
            </aside>
            <nav>
                <header class="footer-title opacity-100">Liên kết nhanh</header>
                <a href="{% url 'home' %}" class="link link-hover">Trang chủ</a>
                <a href="{% url 'room_list' %}" class="link link-hover">Phòng</a>
                <a href="{% url 'service_list' %}" class="link link-hover">Dịch vụ</a>
                <a href="{% url 'gallery' %}" class="link link-hover">Thư viện ảnh</a>
            </nav>
            <nav>
                <header class="footer-title opacity-100">Hỗ trợ</header>
                <a href="{% url 'about' %}" class="link link-hover">Về dự án</a>
                <a href="{% url 'contact' %}" class="link link-hover">Liên hệ</a>
                <a href="#" class="link link-hover">Câu hỏi thường gặp</a>
                <a href="#" class="link link-hover">Chính sách bảo mật</a>
            </nav>
            <nav>
                <header class="footer-title opacity-100">Liên hệ</header>
                <p class="flex items-start gap-2">
                    <i class="fas fa-map-marker-alt text-accent flex-shrink-0 mt-1"></i>
                    <span>Đại học Phan Thiết<br>Phan Thiết, Bình Thuận, Việt Nam</span>
                </p>
                <p class="flex items-center gap-2">
                    <i class="fas fa-envelope text-accent flex-shrink-0"></i>
                    <span>nguyenankhangpro7895123@gmail.com</span>
                </p>
            </nav>
        </div>
        <div class="border-t border-neutral-content/20 mt-8 py-8 text-center text-sm">
            <p class="text-base-content/70">&copy; 2025 The Sailing Bay. All rights reserved. <br class="sm:hidden">
                Made with <span class="text-red-500">❤</span> by Nguyễn An Khang</p>
        </div>
    </footer>


    <dialog id="image_zoom_modal" class="modal">
        <div class="modal-box w-11/12 max-w-5xl p-0 bg-transparent shadow-none">
            <img id="modal_zoom_image" src="" alt="Ảnh phóng to" class="w-full h-auto object-contain" />
            <div class="modal-action absolute top-0 right-0 m-2">
                <form method="dialog">
                    <button class="btn btn-sm btn-circle btn-ghost text-white bg-black/30 hover:bg-black/60">✕</button>
                </form>
            </div>
        </div>
        <form method="dialog" class="modal-backdrop bg-black/70 backdrop-blur-sm">
            <button>đóng</button>
        </form>
    </dialog>


    <script src="{% static 'js/main.js' %}" defer></script>

    {% block extra_js %}{% endblock %}

</body>

</html>